# key-decisions

## 现在就能发现的一些需求漏洞 & 潜在坑

我帮你挑几个产品 + 技术上都很关键的问题，你后面可以专门开一轮只讨论“规则”：

1. **目标文件夹已有同名文件怎么办？**

   - 覆盖？

   - 跳过？

   - 自动重命名（xxx (1).txt）？

   - 还是弹出一个冲突解决策略设置（全局设置 vs 每次询问）？
      👉 这是核心产品决策，目前需求里还没定义，会直接影响领域模型和 UI。

   - **回答:**

     1. 业务逻辑:**默认覆盖**

     2. 添加按钮"文件冲突解决策略设置"，包括
     
        - 全局设置

          1. 覆盖
          2. 跳过
          3. 自动重命名

     
        - 每次询问
     
           👉若选择"每次询问"，则每次遇到冲突文件，弹出对话框，显示: 
     
          1. 覆盖
          2. 跳过
          3. 自动重命名

2. **顺序表缺少删除，顺序上移，顺序下移操作**

   - 如果用户想在顺序表里面调整顺序，目前缺少操作。
   - **回答:**添加按钮"删除"，"上移"，"下移"。点击**顺序表(SequenceList)**中的文件名字，显示 "删除"，"上移"，"下移"，三个按钮，每次点击，后端更新一次**顺序表(SequenceList)**中的内容。

3. **同一个源文件能否在顺序表出现多次？**

   - 如果用户多次 `add` 同一个文件，目前需求没有禁止
   - 如果允许，就会出现 a 在顺序表中是 1 和 5 两个位置
      👉 产品上可以：
   - 允许（用于“多次复制同一份东西”）
   - 或者禁止，并提示“该文件已在顺序表中”。
   - **回答： ** **禁止**，并提示“该文件已在顺序表中”。

4. **大文件 & 复制过程中的反馈**

   - 需求里暂时只有“全部完成之后的弹窗”
   - 但是复制一个 10GB 文件中间没有任何反馈，用户会以为卡死
      👉 需要考虑：
   - 前端是否显示全局进度 / 当前正在复制哪个文件
   - 是否支持“取消复制”
   - **回答：**前端显示全局进度/当前正在复制哪个文件，支持**"取消复制"**

5. **复制失败时的行为**

   - 比如磁盘空间不足 / 权限问题 / 目标路径无效
   - 现在只定义了“成功之后弹窗”
      👉 建议增加：
   - “复制中断弹窗”：展示已成功的文件 + 失败原因 + 后续建议
   - 是否保留顺序表？（方便用户修复问题后再试）

6. **如何保证“不出现半截文件”**

   - 你明确提出“不能是未完整复制的临时文件”
   - 技术上需要清晰策略：
     - 复制到 `xxx.tmp`（或隐藏文件）
     - 成功后 rename → 最终文件名（rename 在同盘内基本是原子操作）
   - 这部分要写进领域规则 / 技术文档，而不是只留在口头约定。

7. **路径和字符集的问题（Windows 特别多坑）**

   - **长路径**（超过 260 字符）
   - **含有特殊字符的路径（中文、emoji、空格、点开头等）**
   - 网络映射盘、U 盘插拔后的盘符变化
      👉 可以抽象成 FilePath 值对象，在 Domain 层不直接操作字符串，而是通过 Infrastructure 提供的“合法化路径”。
   - 回答：
      1. 目前最长的绝对路径长度为**155**，暂时不考虑
      2. UTF-16和UTF-8都支持emoji和中文

8. **文件浏览的“我的电脑”视图实现细节**

   - Wails / Electron 都不能直接复用系统资源管理器的 UI
   - 你要自己实现一套：盘符列表 + 当前路径 + 面包屑 + 文件列表
      👉 这部分属于 Application/UI 逻辑，要注意不把它揉进领域里。

9. **顺序表的多次添加规则，和“位置”概念**

   - 你要求：

     > 第二次添加，他的第一个文件的顺序表位置一定是在第一次添加的最后一个文件后面

   - 这意味着：

     - SequenceList 的顺序是“全局追加”，不允许中间插入
     - 后续如果要支持“调整顺序”（拖拽排序），规则要重新设计
        👉 建议在 `ubiquitous-language.md` 里把“顺序值是只增不减、只能从尾部追加”作为当前版本的领域规则写死。

   